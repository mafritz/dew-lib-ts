<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div id="app">
      <div class="row g-0">
        <!-- DEW -->
        <div class="col-md-5 col-lg-4">
          <section class="bg-light py-3">
            <appraisal-slider
              v-for="(appraisal, index) in appraisals"
              :key="index"
              :question="appraisal.question"
              :number="index"
              @slider-change="onSliderChange($event)"
              class="px-3"
            ></appraisal-slider>

            <div class="mx-4">
              <button
                type="button"
                class="btn btn-primary mb-3 mx-1"
                v-for="(feeling, index) in orderedAffectiveSpace"
              >
                {{feeling.label}}
              </button>
            </div>
          </section>
        </div>

        <!-- Content -->
        <div class="col-md-7 col-lg-8">
          <div class="px-5 mt-2">
            <h1>Configuration</h1>
            <form class="row row-cols-lg-auto g-3 align-items-center">
              <div class="col-6">
                <label
                  class="visually-hidden"
                  for="inlineFormInputGroupEmotions"
                  >Emotions</label
                >
                <div class="input-group">
                  <div class="input-group-text">Number of Emotions</div>
                  <input
                    type="number"
                    class="form-control"
                    id="inlineFormInputGroupEmotions"
                    v-model.number="numEmotions"
                    min="1"
                  />
                </div>
              </div>

              <div class="col-6">
                <label
                  class="visually-hidden"
                  for="inlineFormInputGroupAppraisals"
                  >Appraisals</label
                >
                <div class="input-group">
                  <div class="input-group-text">Number of Appraisals</div>
                  <input
                    type="number"
                    class="form-control"
                    id="inlineFormInputGroupAppraisals"
                    v-model.number="numAppraisals"
                    min="1"
                  />
                </div>
              </div>
            </form>

            <table class="table table-striped table-hover mt-5">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Feeling</th>
                  <th v-for="n in numAppraisals" :key="n">Appraisal {{n}}</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(feeling, index) in affectiveSpace" :key="index">
                  <th>{{index + 1}}</th>
                  <th>{{feeling.label}}</th>
                  <td v-for="i in feeling.coordinates.length" :key="i">
                    {{feeling.coordinates[i-1]}}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/vue@next"></script>
    <script type="module">
      import * as DEW from "../frontend/index.js";
      console.log("DEW loaded");

      const options = {
        data() {
          let appraisals = [
            {
              question: "Required appraisal dimension",
              value: 0,
            },
          ];

          return {
            appraisals: appraisals,
            numAppraisals: appraisals.length,
            numEmotions: 20,
            affectiveSpace: DEW.simulateVectorAffectiveSpace(20, 1),
            orderedAffectiveSpace: [],
          };
        },
        watch: {
          numAppraisals(newValue, oldValue) {
            if (oldValue < newValue) {
              this.appraisals.push({
                question: "Another appraisal dimension",
                value: 0,
              });
            } else {
              this.appraisals.pop();
            }
            this.affectiveSpace = DEW.simulateVectorAffectiveSpace(
              this.numEmotions,
              this.numAppraisals
            );
          },
          numEmotions(newValue, oldValue) {
            this.affectiveSpace = DEW.simulateVectorAffectiveSpace(
              this.numEmotions,
              this.numAppraisals
            );
          },
        },
        computed: {},
        methods: {
          onSliderChange(payload) {
            let whichAppraisal = Number(payload.number);
            let whichValue = Number(payload.value);
            this.appraisals[whichAppraisal].value = whichValue;
            let currentAppraisalProfile = this.appraisals.map(function (el) {
              return el.value;
            });
            this.orderedAffectiveSpace = DEW.sortAffectiveSpace(
              {
                algorithmType: "vector",
                feelings: this.affectiveSpace,
              },
              currentAppraisalProfile
            );
            console.log(currentAppraisalProfile);
            console.log(this.orderedAffectiveSpace);
          },
        },
        created() {},
      };

      let app = Vue.createApp(options);

      app.component("appraisal-slider", {
        data() {
          return {
            value: 0,
          };
        },
        props: ["question", "number"],
        template: `
           <div class="appraisal-slider mb-2 mx-3">
           <label for="sliderX" class="mb-1"><span class="badge bg-dark">{{number + 1}}</span> {{question}}</label>
                    <input
                      type="range"
                      class="form-range"
                      min="-100"
                      max="100"
                      step="1"
                      v-model.number="value"
                      v-on:change="$emit('slider-change', {number: number, value: $event.target.value})"
                    />
          </div>
          `,
      });

      app.mount("#app");
    </script>
  </body>
</html>
